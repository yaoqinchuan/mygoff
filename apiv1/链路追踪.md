# 链路追踪

## 1、准备工作

Jaeger提供了all-in-one镜像，方便我们快速开始测试：

```bash
docker run -d --name jaeger -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 -p 5775:5775/udp -p 6831:6831/udp -p 6832:6832/udp -p 5778:5778 -p 16686:16686 -p 14268:14268 -p 9411:9411 jaegertracing/all-in-one:1.14
```

镜像启动后，通过 http://localhost:16686 可以打开Jaeger UI。

![ ![img](https://gfcdn.johng.cn/download/attachments/38575567/image2021-1-29_10-6-53.png?version=1&modificationDate=1644392844393&api=v2) ]()

## 2、单进程追踪

​		单进程的链路跟踪即进程内方法之间的调用链关系。这种场景的跟踪没有涉及到分布式跟踪，比较简单，以该示例作为我们入门的一个例子吧

### 2.1、Root Span

​		root span即链路中第一个span对象。在这里的单进程场景中，往往需要手动创建一个。随后在方法内部创建的span都会作为它的子级span。

```go
func main() {
	var ctx = gctx.New()
	tp, err := jaeger.Init(ServiceName, JaegerUdpEndpoint)
	if err != nil {
		g.Log().Fatal(ctx, err)
	}
	defer tp.Shutdown(ctx)

	ctx, span := gtrace.NewSpan(ctx, "main")
	defer span.End()
	
	// Trace 1.
	user1 := GetUser(ctx, 1)
	g.Dump(user1)
	
	// Trace 2.
	user100 := GetUser(ctx, 100)
	g.Dump(user100)

}
```

​		上述代码创建了一个root span，并将该span通过context传递给GetUser方法，以便在GetUser方法中将追踪链继续延续下去。

### 2.2、方法间Span创建